<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾ç¨‹å®‰æ’æŸ¥è¯¢ç³»ç»Ÿ</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“š</text></svg>">
    
    <!-- ä¸»è¦CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* ç™»å½•ç•Œé¢æ ·å¼ */
        .login-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-box h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        .login-btn:hover {
            background: #2980b9;
        }
        
        .admin-link {
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 14px;
            cursor: pointer;
        }
        
        /* ç®¡ç†å‘˜ç•Œé¢æ ·å¼ */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .admin-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .admin-box h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .admin-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .admin-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .admin-btn.primary {
            background: #3498db;
            color: white;
        }
        
        .admin-btn.success {
            background: #2ecc71;
            color: white;
        }
        
        .admin-btn.danger {
            background: #e74c3c;
            color: white;
        }
        
        .admin-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .close-admin {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        /* æ–‡ä»¶ç®¡ç†æ ·å¼ */
        .file-management {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .file-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-name {
            flex: 1;
            font-size: 14px;
        }
        
        .file-actions {
            display: flex;
            gap: 5px;
        }
        
        .file-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            font-size: 14px;
            padding: 5px;
        }
        
        .file-action-btn:hover {
            color: #3498db;
        }
        
        .file-action-btn.delete:hover {
            color: #e74c3c;
        }
        
        .file-action-btn.load:hover {
            color: #2ecc71;
        }
        
        .file-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .file-control-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .file-control-btn.load-all {
            background: #3498db;
            color: white;
        }
        
        .file-control-btn.clear-all {
            background: #e74c3c;
            color: white;
        }
        
        /* ä¸»ç³»ç»Ÿæ ·å¼ */
        .main-system {
            display: none;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eaeaea;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }

        .mode-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: #3498db;
            color: white;
        }

        .mode-section {
            display: none;
        }

        .mode-section.active {
            display: block;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 10px 0;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-btn {
            display: inline-block;
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .file-input-btn:hover {
            background: #2980b9;
        }

        .search-box {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }

        select, input[type="text"] {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            min-width: 300px;
            transition: all 0.3s;
            background-color: white;
        }

        select:focus, input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn {
            background-color: #3498db;
            color: white;
        }

        .search-btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .print-btn {
            background-color: #2ecc71;
            color: white;
        }

        .print-btn:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .print-btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .clear-btn {
            background-color: #e74c3c;
            color: white;
        }

        .clear-btn:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        #result, #teacherResult {
            margin-top: 30px;
            overflow-x: auto;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-radius: 10px;
            overflow: hidden;
        }

        .schedule-table th {
            background-color: #3498db;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .schedule-table td {
            padding: 12px 10px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .time-header {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
            width: 100px;
        }

        .period-header {
            background-color: #34495e;
            color: white;
            font-weight: 600;
        }

        .teacher-cell {
            background-color: #e8f5e9;
            color: #2e7d32;
            font-weight: 500;
            transition: all 0.2s;
        }

        .teacher-cell:hover {
            background-color: #c8e6c9;
            transform: scale(1.02);
        }

        .class-cell {
            background-color: #e3f2fd;
            color: #1565c0;
            font-weight: 500;
        }

        .no-class {
            background-color: #f5f5f5;
            color: #9e9e9e;
        }

        .no-result {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #7f8c8d;
            background-color: #f9f9f9;
            border-radius: 10px;
            margin-top: 20px;
        }

        .class-name, .teacher-name {
            color: #3498db;
            font-weight: bold;
        }

        .print-only {
            display: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            select, input[type="text"] {
                min-width: 100%;
            }
            
            .button-group {
                width: 100%;
                justify-content: center;
            }
            
            button {
                flex: 1;
            }
            
            .schedule-table {
                font-size: 14px;
            }
            
            .schedule-table th, 
            .schedule-table td {
                padding: 8px 5px;
            }
        }

        @media print {
            body {
                background: none;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 0;
            }
            
            .search-box, .print-btn, .mode-selector, .upload-section {
                display: none;
            }
            
            .print-only {
                display: block;
                text-align: center;
                margin-bottom: 20px;
                font-size: 14px;
                color: #7f8c8d;
            }
            
            header {
                margin-bottom: 15px;
            }
            
            #result, #teacherResult {
                margin-top: 15px;
            }
            
            .schedule-table {
                box-shadow: none;
            }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .data-status {
            text-align: center;
            margin: 10px 0;
            font-weight: 600;
            color: #27ae60;
        }
        
        .admin-access {
            text-align: center;
            margin-top: 20px;
        }
        
        .admin-toggle {
            background: none;
            border: none;
            color: #3498db;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h2>è¯¾ç¨‹å®‰æ’æŸ¥è¯¢ç³»ç»Ÿ</h2>
            <p>å®‰é˜³å¸‚é¾™å®‰é«˜çº§ä¸­å­¦</p>
            <input type="password" class="login-input" id="loginPassword" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç ">
            <button class="login-btn" onclick="checkPassword()">ç™»å½•ç³»ç»Ÿ</button>
            <div class="admin-link" onclick="showAdminLogin()">ç®¡ç†å‘˜ç™»å½•</div>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜ç™»å½•ç•Œé¢ -->
    <div class="login-container" id="adminLoginContainer" style="display: none;">
        <div class="login-box">
            <h2>ç®¡ç†å‘˜ç™»å½•</h2>
            <input type="password" class="login-input" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            <button class="login-btn" onclick="checkAdminPassword()">ç™»å½•ç®¡ç†ç•Œé¢</button>
            <div class="admin-link" onclick="showUserLogin()">è¿”å›ç”¨æˆ·ç™»å½•</div>
        </div>
    </div>
    
    <!-- ç®¡ç†å‘˜ç•Œé¢ -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-box">
            <button class="close-admin" onclick="closeAdminPanel()">&times;</button>
            <h2>ç³»ç»Ÿç®¡ç†</h2>
            <div class="admin-actions">
                <button class="admin-btn primary" onclick="changeUserPassword()">
                    <i class="fas fa-key"></i> ä¿®æ”¹ç”¨æˆ·å¯†ç 
                </button>
                <button class="admin-btn primary" onclick="changeAdminPassword()">
                    <i class="fas fa-user-shield"></i> ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
                </button>
                <button class="admin-btn success" onclick="exportData()">
                    <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
                </button>
                
                <!-- æ–‡ä»¶ç®¡ç†éƒ¨åˆ† -->
                <div class="file-management">
                    <h3>æ–‡ä»¶ç®¡ç†</h3>
                    <div class="file-list" id="fileList">
                        <!-- æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div class="file-controls">
                        <button class="file-control-btn load-all" onclick="loadAllFiles()">
                            <i class="fas fa-folder-open"></i> åŠ è½½æ‰€æœ‰æ–‡ä»¶
                        </button>
                        <button class="file-control-btn clear-all" onclick="clearAllFiles()">
                            <i class="fas fa-trash"></i> æ¸…é™¤æ‰€æœ‰æ–‡ä»¶
                        </button>
                    </div>
                </div>
                
                <button class="admin-btn danger" onclick="clearAllData()">
                    <i class="fas fa-trash"></i> æ¸…é™¤æ‰€æœ‰æ•°æ®
                </button>
                <button class="admin-btn" onclick="viewCode()" style="background: #9b59b6; color: white;">
                    <i class="fas fa-code"></i> æŸ¥çœ‹æºä»£ç  (éœ€å¯†ç )
                </button>
            </div>
        </div>
    </div>
    
    <!-- ä¸»ç³»ç»Ÿç•Œé¢ -->

         <h1>ä¸‹è½½ XLSX æ–‡ä»¶</h1>
    
    <!-- ç›´æ¥ä½¿ç”¨ raw é“¾æ¥ -->
    <a href="https://raw.githubusercontent.com/qq815571629/jubilant-computing-machine/main/æ€»è¯¾ç¨‹ï¼ˆæ•™å¸ˆå§“åï¼‰2025-2026å­¦å¹´ç¬¬ä¸€å­¦æœŸé›†è®­ç‰ˆ.xlsx" 
       download="æ€»è¯¾ç¨‹ï¼ˆæ•™å¸ˆå§“åï¼‰2025-2026å­¦å¹´ç¬¬ä¸€å­¦æœŸé›†è®­ç‰ˆ.xlsx" 
       style="display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 5px;">
       ç‚¹å‡»ä¸‹è½½ XLSX æ–‡ä»¶
    </a>



    <div class="main-system" id="mainSystem">
        <div class="container">
            <header>
                <h1>è¯¾ç¨‹å®‰æ’æŸ¥è¯¢ç³»ç»Ÿ</h1>
                <p class="subtitle">å®‰é˜³å¸‚é¾™å®‰é«˜çº§ä¸­å­¦</p>
                <div class="admin-access">
                    <button class="admin-toggle" onclick="showAdminLogin()">ç®¡ç†å‘˜å…¥å£</button>
                </div>
            </header>
            
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="class">ç­çº§è¯¾è¡¨æŸ¥è¯¢</button>
                <button class="mode-btn" data-mode="teacher">æ•™å¸ˆä»»è¯¾æŸ¥è¯¢</button>
            </div>
            
            <div class="upload-section">
                <h3>ä¸Šä¼ è¯¾ç¨‹å®‰æ’è¡¨æ ¼</h3>
                <div class="file-input-wrapper">
                    <button class="file-input-btn">
                        <i class="fas fa-upload"></i> é€‰æ‹©Excelæ–‡ä»¶
                    </button>
                    <input type="file" id="fileInput" accept=".xlsx, .xls">
                </div>
                <p id="fileName">æœªé€‰æ‹©æ–‡ä»¶</p>
                <div class="data-status" id="dataStatus">æš‚æ— æ•°æ®ï¼Œè¯·ä¸Šä¼ è¯¾ç¨‹å®‰æ’è¡¨æ ¼</div>
            </div>
            
            <!-- ç­çº§è¯¾è¡¨æŸ¥è¯¢éƒ¨åˆ† -->
            <div class="mode-section active" id="classSection">
                <div class="search-box">
                    <select id="className">
                        <option value="">è¯·é€‰æ‹©ç­çº§</option>
                    </select>
                    <div class="button-group">
                        <button class="search-btn" onclick="searchSchedule()">
                            <i class="fas fa-search"></i> æŸ¥è¯¢è¯¾è¡¨
                        </button>
                        <button class="clear-btn" onclick="clearSearch()">
                            <i class="fas fa-eraser"></i> æ¸…é™¤æœç´¢
                        </button>
                        <button class="print-btn" id="printBtn" onclick="printSchedule()" disabled>
                            <i class="fas fa-print"></i> æ‰“å°è¯¾è¡¨
                        </button>
                    </div>
                </div>
                
                <div id="result"></div>
            </div>
            
            <!-- æ•™å¸ˆä»»è¯¾æŸ¥è¯¢éƒ¨åˆ† -->
            <div class="mode-section" id="teacherSection">
                <div class="search-box">
                    <input type="text" id="teacherName" placeholder="è¯·è¾“å…¥æ•™å¸ˆå§“å">
                    <div class="button-group">
                        <button class="search-btn" onclick="searchTeacherSchedule()">
                            <i class="fas fa-search"></i> æŸ¥è¯¢ä»»è¯¾
                        </button>
                        <button class="clear-btn" onclick="clearTeacherSearch()">
                            <i class="fas fa-eraser"></i> æ¸…é™¤æœç´¢
                        </button>
                        <button class="print-btn" id="printTeacherBtn" onclick="printTeacherSchedule()" disabled>
                            <i class="fas fa-print"></i> æ‰“å°è¯¾è¡¨
                        </button>
                    </div>
                </div>
                
                <div id="teacherResult"></div>
            </div>
            
            <div class="footer">
                <p>Â©è¯¾ç¨‹å®‰æ’æŸ¥è¯¢ç³»ç»Ÿ | æŠ€æœ¯æ”¯æŒ: å®‰é˜³å¸‚é¾™å®‰é«˜çº§ä¸­å­¦ æ•™åŠ¡å¤„</p>
            </div>
        </div>
    </div>

    <script>
             // èµ„æºåŠ è½½æ£€æµ‹
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'LINK' || e.target.tagName === 'SCRIPT') {
                console.warn('èµ„æºåŠ è½½å¤±è´¥ï¼Œä½†ç³»ç»Ÿä»å¯è¿è¡Œ:', e.target.src || e.target.href);
            }
        }, true);
        
        // å¦‚æœXLSXåº“åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤ºä½†å…è®¸åŸºæœ¬åŠŸèƒ½
        setTimeout(function() {
            if (typeof XLSX === 'undefined') {
                console.warn('XLSXåº“åŠ è½½å¤±è´¥,æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å°†ä¸å¯ç”¨');
                document.getElementById('fileInput').disabled = true;
                document.getElementById('fileInput').title = 'XLSXåº“åŠ è½½å¤±è´¥,è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥';
            }
        }, 2000);
        // å¯†ç éªŒè¯å’ŒåŠ å¯†ç›¸å…³åŠŸèƒ½
        let userPassword = "123456"; // é»˜è®¤ç”¨æˆ·å¯†ç 
        let adminPassword = "123456.."; // é»˜è®¤ç®¡ç†å‘˜å¯†ç 
        let isAdmin = false;
        
        // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰ä¿å­˜çš„å¯†ç 
        if (localStorage.getItem('userPassword')) {
            userPassword = localStorage.getItem('userPassword');
        }
        
        if (localStorage.getItem('adminPassword')) {
            adminPassword = localStorage.getItem('adminPassword');
        }
        
        // æ–‡ä»¶ç®¡ç†ç›¸å…³å˜é‡
        let uploadedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
        let currentFilesData = JSON.parse(localStorage.getItem('currentFilesData') || '{}');
        
        // æ£€æŸ¥ç”¨æˆ·å¯†ç 
        function checkPassword() {
            const input = document.getElementById('loginPassword').value;
            if (input === userPassword) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainSystem').style.display = 'block';
                
                // åŠ è½½å·²ä¿å­˜çš„æ–‡ä»¶æ•°æ®
                loadSavedFilesData();
            } else {
                alert('å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // æ£€æŸ¥ç®¡ç†å‘˜å¯†ç 
        function checkAdminPassword() {
            const input = document.getElementById('adminPassword').value;
            if (input === adminPassword) {
                document.getElementById('adminLoginContainer').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'flex';
                isAdmin = true;
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                updateFileList();
            } else {
                alert('ç®¡ç†å‘˜å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ï¼');
            }
        }
        
        // æ˜¾ç¤ºç®¡ç†å‘˜ç™»å½•
        function showAdminLogin() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminLoginContainer').style.display = 'flex';
        }
        
        // æ˜¾ç¤ºç”¨æˆ·ç™»å½•
        function showUserLogin() {
            document.getElementById('adminLoginContainer').style.display = 'none';
            document.getElementById('loginContainer').style.display = 'flex';
        }
        
        // å…³é—­ç®¡ç†å‘˜é¢æ¿
        function closeAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
            isAdmin = false;
        }
        
        // ä¿®æ”¹ç”¨æˆ·å¯†ç 
        function changeUserPassword() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            const newPassword = prompt('è¯·è¾“å…¥æ–°çš„ç”¨æˆ·å¯†ç ï¼š');
            if (newPassword && newPassword.length >= 4) {
                userPassword = newPassword;
                localStorage.setItem('userPassword', newPassword);
                alert('ç”¨æˆ·å¯†ç ä¿®æ”¹æˆåŠŸï¼');
            } else {
                alert('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº4ä½ï¼');
            }
        }
        
        // ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
        function changeAdminPassword() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            const newPassword = prompt('è¯·è¾“å…¥æ–°çš„ç®¡ç†å‘˜å¯†ç ï¼š');
            if (newPassword && newPassword.length >= 4) {
                adminPassword = newPassword;
                localStorage.setItem('adminPassword', newPassword);
                alert('ç®¡ç†å‘˜å¯†ç ä¿®æ”¹æˆåŠŸï¼');
            } else {
                alert('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº4ä½ï¼');
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            // è¿™é‡Œå¯ä»¥å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½
            alert('æ•°æ®å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.clear();
                scheduleData = [];
                classes = [];
                teachers = [];
                uploadedFiles = [];
                currentFilesData = {};
                document.getElementById('dataStatus').textContent = 'æ•°æ®å·²æ¸…é™¤';
                updateFileList();
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤ï¼');
            }
        }
        
        // æŸ¥çœ‹æºä»£ç ï¼ˆéœ€è¦å¯†ç ï¼‰
        function viewCode() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            const codePassword = prompt('è¯·è¾“å…¥æŸ¥çœ‹æºä»£ç çš„å¯†ç ï¼š');
            // è¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸ªç‰¹æ®Šçš„å¯†ç æ¥æŸ¥çœ‹æºä»£ç 
            if (codePassword === '123456..') {
                // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥æ˜¾ç¤ºæºä»£ç 
                // ä½†å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæˆ‘ä»¬åªæ˜¾ç¤ºä¸€ä¸ªæç¤º
                alert('å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæºä»£ç æŸ¥çœ‹åŠŸèƒ½å·²ç¦ç”¨ã€‚');
            } else {
                alert('å¯†ç é”™è¯¯ï¼');
            }
        }
        
        // æ–‡ä»¶ç®¡ç†åŠŸèƒ½
        function updateFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            if (uploadedFiles.length === 0) {
                fileList.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">æš‚æ— å·²ä¿å­˜çš„æ–‡ä»¶</div>';
                return;
            }
            
            uploadedFiles.forEach((fileInfo, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                fileItem.innerHTML = `
                    <div class="file-name">${fileInfo.name}</div>
                    <div class="file-actions">
                        <button class="file-action-btn load" onclick="loadFileData(${index})" title="åŠ è½½æ­¤æ–‡ä»¶">
                            <i class="fas fa-folder-open"></i>
                        </button>
                        <button class="file-action-btn delete" onclick="deleteFile(${index})" title="åˆ é™¤æ­¤æ–‡ä»¶">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                fileList.appendChild(fileItem);
            });
        }
        
        function deleteFile(index) {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${uploadedFiles[index].name}" å—ï¼Ÿ`)) {
                // ä»ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ä¸­åˆ é™¤
                uploadedFiles.splice(index, 1);
                
                // ä»å½“å‰æ–‡ä»¶æ•°æ®ä¸­åˆ é™¤
                delete currentFilesData[uploadedFiles[index]?.name];
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                localStorage.setItem('currentFilesData', JSON.stringify(currentFilesData));
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                updateFileList();
                
                alert('æ–‡ä»¶å·²åˆ é™¤ï¼');
            }
        }
        
        function loadFileData(index) {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            const fileName = uploadedFiles[index].name;
            const fileData = currentFilesData[fileName];
            
            if (fileData) {
                // ä½¿ç”¨æ–‡ä»¶æ•°æ®åˆå§‹åŒ–ç³»ç»Ÿ
                scheduleData = fileData.scheduleData || [];
                classes = fileData.classes || [];
                teachers = fileData.teachers || [];
                
                // æ›´æ–°ç•Œé¢
                document.getElementById('fileName').textContent = fileName;
                document.getElementById('dataStatus').textContent = `å·²åŠ è½½æ–‡ä»¶: ${fileName} (å…±${classes.length}ä¸ªç­çº§)`;
                populateClassSelect();
                
                alert(`æ–‡ä»¶ "${fileName}" å·²åŠ è½½ï¼`);
            } else {
                alert('æ–‡ä»¶æ•°æ®ä¸å­˜åœ¨ï¼');
            }
        }
        
        function loadAllFiles() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            // åˆå¹¶æ‰€æœ‰æ–‡ä»¶çš„æ•°æ®
            scheduleData = [];
            classes = [];
            teachers = [];
            
            uploadedFiles.forEach(fileInfo => {
                const fileData = currentFilesData[fileInfo.name];
                if (fileData) {
                    // åˆå¹¶æ•°æ®ï¼ˆè¿™é‡Œç®€å•åˆå¹¶ï¼Œå®é™…å¯èƒ½éœ€è¦æ›´å¤æ‚çš„é€»è¾‘ï¼‰
                    scheduleData = scheduleData.concat(fileData.scheduleData || []);
                    classes = classes.concat(fileData.classes || []);
                    teachers = [...new Set([...teachers, ...(fileData.teachers || [])])];
                }
            });
            
            // æ›´æ–°ç•Œé¢
            document.getElementById('fileName').textContent = `å·²åŠ è½½ ${uploadedFiles.length} ä¸ªæ–‡ä»¶`;
            document.getElementById('dataStatus').textContent = `å·²åŠ è½½ ${uploadedFiles.length} ä¸ªæ–‡ä»¶ï¼Œå…±${classes.length}ä¸ªç­çº§`;
            populateClassSelect();
            
            alert(`å·²åŠ è½½æ‰€æœ‰ ${uploadedFiles.length} ä¸ªæ–‡ä»¶ï¼`);
        }
        
        function clearAllFiles() {
            if (!isAdmin) {
                alert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å·²ä¿å­˜çš„æ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                uploadedFiles = [];
                currentFilesData = {};
                
                // æ›´æ–°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                localStorage.setItem('currentFilesData', JSON.stringify(currentFilesData));
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                updateFileList();
                
                alert('æ‰€æœ‰æ–‡ä»¶å·²æ¸…é™¤ï¼');
            }
        }
        
        function loadSavedFilesData() {
            // å¦‚æœæœ‰ä¿å­˜çš„æ–‡ä»¶æ•°æ®ï¼ŒåŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶
            if (uploadedFiles.length > 0) {
                const firstFile = uploadedFiles[0];
                const fileData = currentFilesData[firstFile.name];
                
                if (fileData) {
                    scheduleData = fileData.scheduleData || [];
                    classes = fileData.classes || [];
                    teachers = fileData.teachers || [];
                    
                    document.getElementById('fileName').textContent = firstFile.name;
                    document.getElementById('dataStatus').textContent = `å·²åŠ è½½æ–‡ä»¶: ${firstFile.name} (å…±${classes.length}ä¸ªç­çº§)`;
                    populateClassSelect();
                }
            }
        }
        
        // æ”¯æŒæŒ‰Enteré”®ç™»å½•
        document.getElementById('loginPassword').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
        
        document.getElementById('adminPassword').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                checkAdminPassword();
            }
        });
        
        // ä»¥ä¸‹æ˜¯åŸç³»ç»Ÿçš„åŠŸèƒ½ä»£ç 
        // å…¨å±€å˜é‡
        let scheduleData = []; // å­˜å‚¨è§£æåçš„è¯¾è¡¨æ•°æ®
        let classes = []; // å­˜å‚¨ç­çº§åˆ—è¡¨
        let teachers = []; // å­˜å‚¨æ•™å¸ˆåˆ—è¡¨
        
        // æ¨¡å¼åˆ‡æ¢
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.mode-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.getElementById(this.dataset.mode + 'Section').classList.add('active');
            });
        });
        
        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('dataStatus').textContent = 'æ­£åœ¨è§£ææ•°æ®...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    // å°†å·¥ä½œè¡¨è½¬æ¢ä¸ºJSON
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
                    
                    // è§£ææ•°æ®
                    parseScheduleData(jsonData, file.name);
                    
                    document.getElementById('dataStatus').textContent = `æ•°æ®åŠ è½½æˆåŠŸï¼å…±è§£æ ${classes.length} ä¸ªç­çº§çš„è¯¾è¡¨`;
                    
                    // å¡«å……ç­çº§ä¸‹æ‹‰æ¡†
                    populateClassSelect();
                    
                    // ä¿å­˜æ–‡ä»¶æ•°æ®
                    saveFileData(file.name);
                    
                } catch (error) {
                    console.error('è§£æExcelæ–‡ä»¶æ—¶å‡ºé”™:', error);
                    document.getElementById('dataStatus').textContent = 'è§£ææ–‡ä»¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼';
                }
            };
            reader.readAsArrayBuffer(file);
        });
        
        // ä¿å­˜æ–‡ä»¶æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveFileData(fileName) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæ–‡ä»¶
            const existingFileIndex = uploadedFiles.findIndex(f => f.name === fileName);
            
            if (existingFileIndex === -1) {
                // æ–°æ–‡ä»¶ï¼Œæ·»åŠ åˆ°åˆ—è¡¨
                uploadedFiles.push({
                    name: fileName,
                    uploadTime: new Date().toLocaleString()
                });
            } else {
                // æ›´æ–°ç°æœ‰æ–‡ä»¶çš„ä¸Šä¼ æ—¶é—´
                uploadedFiles[existingFileIndex].uploadTime = new Date().toLocaleString();
            }
            
            // ä¿å­˜æ–‡ä»¶æ•°æ®
            currentFilesData[fileName] = {
                scheduleData: scheduleData,
                classes: classes,
                teachers: teachers,
                uploadTime: new Date().toLocaleString()
            };
            
            // æ›´æ–°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
            localStorage.setItem('currentFilesData', JSON.stringify(currentFilesData));
            
            // å¦‚æœæ˜¯ç®¡ç†å‘˜ç•Œé¢æ‰“å¼€ï¼Œæ›´æ–°æ–‡ä»¶åˆ—è¡¨
            if (isAdmin) {
                updateFileList();
            }
        }
        
        // è§£æè¯¾ç¨‹å®‰æ’æ•°æ®
        function parseScheduleData(data, fileName) {
            // æ¸…ç©ºç°æœ‰æ•°æ®
            scheduleData = [];
            classes = [];
            teachers = new Set();
            
            // ä»ç¬¬3è¡Œå¼€å§‹æ˜¯æ•°æ®ï¼ˆè·³è¿‡æ ‡é¢˜è¡Œï¼‰
            for (let i = 3; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                const className = row[0];
                if (!className) continue;
                
                classes.push(className);
                
                // åˆ›å»ºç­çº§è¯¾è¡¨å¯¹è±¡
                const classSchedule = {
                    "å‘¨ä¸€": {}, "å‘¨äºŒ": {}, "å‘¨ä¸‰": {}, "å‘¨å››": {}, "å‘¨äº”": {}
                };
                
                // åˆ—ç´¢å¼•æ˜ å°„
                // å‘¨ä¸€: 1-9, å‘¨äºŒ: 10-18, å‘¨ä¸‰: 19-27, å‘¨å››: 28-36, å‘¨äº”: 37-45
                const dayMap = {
                    "å‘¨ä¸€": {start: 1, end: 9},
                    "å‘¨äºŒ": {start: 10, end: 18},
                    "å‘¨ä¸‰": {start: 19, end: 27},
                    "å‘¨å››": {start: 28, end: 36},
                    "å‘¨äº”": {start: 37, end: 45}
                };
                
                // èŠ‚æ¬¡æ˜ å°„
                const periodMap = {
                    1: "ä¸Šåˆ_1", 2: "ä¸Šåˆ_2", 3: "ä¸Šåˆ_3", 4: "ä¸Šåˆ_4", 5: "ä¸Šåˆ_5",
                    6: "ä¸‹åˆ_6", 7: "ä¸‹åˆ_7", 8: "ä¸‹åˆ_8", 9: "ä¸‹åˆ_9"
                };
                
                // å¡«å……è¯¾è¡¨æ•°æ®
                for (const day in dayMap) {
                    const {start, end} = dayMap[day];
                    
                    for (let j = start; j <= end; j++) {
                        const periodIndex = j - start + 1;
                        const teacher = row[j] || "";
                        
                        if (teacher) {
                            classSchedule[day][periodMap[periodIndex]] = teacher;
                            teachers.add(teacher);
                        }
                    }
                }
                
                scheduleData.push(classSchedule);
            }
            
            // å°†Setè½¬æ¢ä¸ºæ•°ç»„
            teachers = Array.from(teachers).sort();
        }
        
        // å¡«å……ç­çº§ä¸‹æ‹‰æ¡†
        function populateClassSelect() {
            const classSelect = document.getElementById('className');
            classSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç­çº§</option>';
            
            classes.forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                classSelect.appendChild(option);
            });
        }
        
        // æŸ¥è¯¢ç­çº§è¯¾è¡¨
        function searchSchedule() {
            const className = document.getElementById('className').value;
            const resultDiv = document.getElementById('result');
            const printBtn = document.getElementById('printBtn');
            resultDiv.innerHTML = '';
            
            if (!className) {
                resultDiv.innerHTML = '<div class="no-result">è¯·é€‰æ‹©ç­çº§</div>';
                printBtn.disabled = true;
                return;
            }
            
            // è·å–ç­çº§ç´¢å¼•
            const classIndex = classes.indexOf(className);
            if (classIndex === -1) {
                resultDiv.innerHTML = '<div class="no-result">æœªæ‰¾åˆ°è¯¥ç­çº§</div>';
                printBtn.disabled = true;
                return;
            }
            
            // è·å–è¯¥ç­çº§çš„è¯¾è¡¨æ•°æ®
            const classSchedule = scheduleData[classIndex];
            
            // åˆ›å»ºè¯¾è¡¨æ•°æ®ç»“æ„ï¼š9èŠ‚è¯¾x5å¤©
            const scheduleMatrix = Array(9).fill().map(() => Array(5).fill(null));
            
            // æ˜ å°„æ˜ŸæœŸå‡ åˆ°ç´¢å¼•
            const dayMap = {'å‘¨ä¸€': 0, 'å‘¨äºŒ': 1, 'å‘¨ä¸‰': 2, 'å‘¨å››': 3, 'å‘¨äº”': 4};
            
            // æ˜ å°„èŠ‚æ¬¡åˆ°ç´¢å¼•
            const periodMap = {
                'ä¸Šåˆ_1': 0, 'ä¸Šåˆ_2': 1, 'ä¸Šåˆ_3': 2, 'ä¸Šåˆ_4': 3, 'ä¸Šåˆ_5': 4,
                'ä¸‹åˆ_6': 5, 'ä¸‹åˆ_7': 6, 'ä¸‹åˆ_8': 7, 'ä¸‹åˆ_9': 8
            };
            
            // å¡«å……è¯¾è¡¨æ•°æ®
            for (const day in classSchedule) {
                const dayIndex = dayMap[day];
                
                for (const period in classSchedule[day]) {
                    const teacher = classSchedule[day][period];
                    const periodIndex = periodMap[period];
                    
                    if (periodIndex !== undefined && dayIndex !== undefined) {
                        scheduleMatrix[periodIndex][dayIndex] = teacher;
                    }
                }
            }
            
            // åˆ›å»ºè¡¨æ ¼
            const table = document.createElement('table');
            table.className = 'schedule-table';
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            let headerRow = document.createElement('tr');
            
            const timeHeader = document.createElement('th');
            timeHeader.className = 'period-header';
            timeHeader.textContent = 'æ—¶é—´';
            headerRow.appendChild(timeHeader);
            
            ['æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”'].forEach(day => {
                const th = document.createElement('th');
                th.textContent = day;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨æ ¼ä¸»ä½“
            const tbody = document.createElement('tbody');
            const periodLabels = [
                'ä¸Šåˆç¬¬1èŠ‚', 'ä¸Šåˆç¬¬2èŠ‚', 'ä¸Šåˆç¬¬3èŠ‚', 'ä¸Šåˆç¬¬4èŠ‚', 'ä¸Šåˆç¬¬5èŠ‚',
                'ä¸‹åˆç¬¬6èŠ‚', 'ä¸‹åˆç¬¬7èŠ‚', 'ä¸‹åˆç¬¬8èŠ‚', 'ä¸‹åˆç¬¬9èŠ‚'
            ];
            
            for (let i = 0; i < scheduleMatrix.length; i++) {
                const row = document.createElement('tr');
                
                // æ—¶é—´æ®µæ ‡é¢˜
                const periodCell = document.createElement('td');
                periodCell.className = 'time-header';
                periodCell.textContent = periodLabels[i];
                row.appendChild(periodCell);
                
                // è¯¾ç¨‹å•å…ƒæ ¼
                for (let j = 0; j < scheduleMatrix[i].length; j++) {
                    const cell = document.createElement('td');
                    if (scheduleMatrix[i][j] && scheduleMatrix[i][j] !== "NaN") {
                        cell.className = 'teacher-cell';
                        cell.textContent = scheduleMatrix[i][j];
                    } else {
                        cell.className = 'no-class';
                        cell.textContent = '-';
                    }
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            }
            
            table.appendChild(tbody);
            
            const heading = document.createElement('h2');
            heading.innerHTML = `<span class="class-name">${className}</span> çš„è¯¾è¡¨`;
            resultDiv.appendChild(heading);
            
            const printNote = document.createElement('div');
            printNote.className = 'print-only';
            printNote.textContent = `ç­çº§: ${className} | ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}`;
            resultDiv.appendChild(printNote);
            
            resultDiv.appendChild(table);
            printBtn.disabled = false;
        }
        
        // æŸ¥è¯¢æ•™å¸ˆä»»è¯¾å®‰æ’
        function searchTeacherSchedule() {
            const teacherName = document.getElementById('teacherName').value.trim();
            const resultDiv = document.getElementById('teacherResult');
            const printBtn = document.getElementById('printTeacherBtn');
            resultDiv.innerHTML = '';
            
            if (!teacherName) {
                resultDiv.innerHTML = '<div class="no-result">è¯·è¾“å…¥æ•™å¸ˆå§“å</div>';
                printBtn.disabled = true;
                return;
            }
            
            // æŸ¥æ‰¾æ•™å¸ˆä»»è¯¾å®‰æ’
            const teacherSchedule = {};
            
            // åˆå§‹åŒ–æ•™å¸ˆè¯¾è¡¨ç»“æ„
            const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”'];
            const periods = ['ä¸Šåˆ_1', 'ä¸Šåˆ_2', 'ä¸Šåˆ_3', 'ä¸Šåˆ_4', 'ä¸Šåˆ_5', 'ä¸‹åˆ_6', 'ä¸‹åˆ_7', 'ä¸‹åˆ_8', 'ä¸‹åˆ_9'];
            
            days.forEach(day => {
                teacherSchedule[day] = {};
                periods.forEach(period => {
                    teacherSchedule[day][period] = [];
                });
            });
            
            // éå†æ‰€æœ‰ç­çº§çš„è¯¾è¡¨ï¼ŒæŸ¥æ‰¾è¯¥æ•™å¸ˆçš„ä»»è¯¾
            for (let i = 0; i < classes.length; i++) {
                const className = classes[i];
                const classSchedule = scheduleData[i];
                
                for (const day in classSchedule) {
                    for (const period in classSchedule[day]) {
                        if (classSchedule[day][period] === teacherName) {
                            teacherSchedule[day][period].push(className);
                        }
                    }
                }
            }
            
            // åˆ›å»ºæ•™å¸ˆä»»è¯¾è¡¨æ ¼
            const table = document.createElement('table');
            table.className = 'schedule-table';
            
            // åˆ›å»ºè¡¨å¤´
            const thead = document.createElement('thead');
            let headerRow = document.createElement('tr');
            
            const timeHeader = document.createElement('th');
            timeHeader.className = 'period-header';
            timeHeader.textContent = 'æ—¶é—´';
            headerRow.appendChild(timeHeader);
            
            ['æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”'].forEach(day => {
                const th = document.createElement('th');
                th.textContent = day;
                headerRow.appendChild(th);
            });
            
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // åˆ›å»ºè¡¨æ ¼ä¸»ä½“
            const tbody = document.createElement('tbody');
            const periodLabels = [
                'ä¸Šåˆç¬¬1èŠ‚', 'ä¸Šåˆç¬¬2èŠ‚', 'ä¸Šåˆç¬¬3èŠ‚', 'ä¸Šåˆç¬¬4èŠ‚', 'ä¸Šåˆç¬¬5èŠ‚',
                'ä¸‹åˆç¬¬6èŠ‚', 'ä¸‹åˆç¬¬7èŠ‚', 'ä¸‹åˆç¬¬8èŠ‚', 'ä¸‹åˆç¬¬9èŠ‚'
            ];
            
            const periodMap = {
                'ä¸Šåˆ_1': 0, 'ä¸Šåˆ_2': 1, 'ä¸Šåˆ_3': 2, 'ä¸Šåˆ_4': 3, 'ä¸Šåˆ_5': 4,
                'ä¸‹åˆ_6': 5, 'ä¸‹åˆ_7': 6, 'ä¸‹åˆ_8': 7, 'ä¸‹åˆ_9': 8
            };
            
            const dayMap = {'å‘¨ä¸€': 0, 'å‘¨äºŒ': 1, 'å‘¨ä¸‰': 2, 'å‘¨å››': 3, 'å‘¨äº”': 4};
            
            for (let i = 0; i < periods.length; i++) {
                const row = document.createElement('tr');
                
                // æ—¶é—´æ®µæ ‡é¢˜
                const periodCell = document.createElement('td');
                periodCell.className = 'time-header';
                periodCell.textContent = periodLabels[i];
                row.appendChild(periodCell);
                
                // è¯¾ç¨‹å•å…ƒæ ¼
                for (let j = 0; j < days.length; j++) {
                    const cell = document.createElement('td');
                    const classesForPeriod = teacherSchedule[days[j]][periods[i]];
                    
                    if (classesForPeriod.length > 0) {
                        cell.className = 'class-cell';
                        cell.textContent = classesForPeriod.join(', ');
                    } else {
                        cell.className = 'no-class';
                        cell.textContent = '-';
                    }
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            }
            
            table.appendChild(tbody);
            
            const heading = document.createElement('h2');
            heading.innerHTML = `<span class="teacher-name">${teacherName}</span> çš„ä»»è¯¾å®‰æ’`;
            resultDiv.appendChild(heading);
            
            const printNote = document.createElement('div');
            printNote.className = 'print-only';
            printNote.textContent = `æ•™å¸ˆ: ${teacherName} | ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString()}`;
            resultDiv.appendChild(printNote);
            
            resultDiv.appendChild(table);
            printBtn.disabled = false;
        }
        
        // æ¸…é™¤ç­çº§æœç´¢
        function clearSearch() {
            document.getElementById('className').value = '';
            document.getElementById('result').innerHTML = '';
            document.getElementById('printBtn').disabled = true;
        }
        
        // æ¸…é™¤æ•™å¸ˆæœç´¢
        function clearTeacherSearch() {
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherResult').innerHTML = '';
            document.getElementById('printTeacherBtn').disabled = true;
        }
        
        // æ‰“å°ç­çº§è¯¾è¡¨
        function printSchedule() {
            window.print();
        }
        
        // æ‰“å°æ•™å¸ˆè¯¾è¡¨
        function printTeacherSchedule() {
            window.print();
        }
        
        // æ”¯æŒæŒ‰Enteré”®æœç´¢
        document.getElementById('className').addEventListener('change', searchSchedule);
        document.getElementById('teacherName').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                searchTeacherSchedule();
            }
        });
        
        // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®ï¼ˆå¦‚æœæ²¡æœ‰ä¸Šä¼ æ–‡ä»¶æ—¶ä½¿ç”¨ï¼‰
        function initSampleData() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ ç¤ºä¾‹æ•°æ®ï¼Œä½†ä¸ºäº†ç®€æ´ï¼Œæˆ‘ä»¬ç•™ç©º
            // ç”¨æˆ·éœ€è¦ä¸Šä¼ Excelæ–‡ä»¶æ‰èƒ½ä½¿ç”¨ç³»ç»Ÿ
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = initSampleData;
    </script>

</body>
</html>